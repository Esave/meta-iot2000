#!/bin/sh

## NOTE this config file is generated by the mediaimg-wos wic script.
##      move it to /conf or where else configuration is handled centrally
CONFIGFILE=/etc/hawkbit.cfg

. /etc/init.d/functions

if [ -e "$CONFIGFILE" ]; then
    HAWKBITURL=`grep url $CONFIGFILE | sed -e 's/url=//g'` 
    DEVICENAME=`grep devname $CONFIGFILE | sed -e 's/devname=//g'` 
fi

if [ -z "$HAWKBITURL" ]; then
    HAWKBITURL='192.178.0.10:8080'
fi

if [ -z "$DEVICENAME" ]; then
    DEVICENAME='SIMATIC-IOT2040'
fi

case "$1" in
    start)
        echo "Starting swupdate daemon"
        /sbin/start-stop-daemon -S -x /usr/bin/swupdate -- -l 5 -f /etc/swupdate.cfg -u "" 2>&1 | logger -t swprv &
        echo "done."
    ;;
    stop)
        echo "Stopping swupdate daemon"
        /sbin/start-stop-daemon -K -x /usr/bin/swupdate
        echo "done."
    ;;
    restart)
        $0 stop
        $0 start
    ;;
    status)
    ;;
    *)
        echo "Usage: /etc/init.d/swupdate {start|stop|restart}"
        exit 1
    ;;
esac
